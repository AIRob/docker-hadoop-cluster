language: java
sudo: required

env:
  global:
    - MAVEN_OPTS="-Xmx512M"

services:
  - docker

before_install:
  - docker info
  - git submodule update --init
  -

install:
  - wget https://protobuf.googlecode.com/files/protobuf-2.5.1.tar.gz
  - tar -xzvf protobuf-2.5.1.tar.gz
  - pushd protobuf-2.5.1 && ./configure --prefix=/usr && make && sudo make install && popd
  - cd hadoop
  - mvn clean package -DskipTests -Pdist -Dtar
  - exit
  - cp hadoop-dist/target/hadoop-3.0.0-alpha2-SNAPSHOT.tar.gz ../hadoop-base

script:
  - cd ..
  - make

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push lewuathe/hadoop-base:latest;
    docker push lewuathe/hadoop-coordinator:latest;
    docker push lewuathe/hadoop-worker:latest;
    fi
